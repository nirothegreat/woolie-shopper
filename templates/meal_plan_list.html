{% extends "base.html" %}

{% block title %}Saved Meal Plans - Woolies Shopper{% endblock %}

{% block content %}
<h1>ğŸ“‹ Saved Meal Plans</h1>
<p class="text-muted">Load a previously saved meal plan or manage your saved plans</p>

<div class="flex gap-1 mb-3">
    <a href="{{ url_for('meal_plan') }}" class="btn btn-secondary">â† Back to Current Plan</a>
</div>

{% if meal_plans %}
<div class="card">
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background: #f5f5f5;">
                <th style="padding: 0.75rem; text-align: left; border-bottom: 2px solid #ddd;">Plan Name</th>
                <th style="padding: 0.75rem; text-align: left; border-bottom: 2px solid #ddd;">Date Range</th>
                <th style="padding: 0.75rem; text-align: left; border-bottom: 2px solid #ddd;">Created</th>
                <th style="padding: 0.75rem; text-align: left; border-bottom: 2px solid #ddd;">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for plan in meal_plans %}
            <tr style="border-bottom: 1px solid #e0e0e0;">
                <td style="padding: 0.75rem;">
                    <strong>{{ plan.get('name', 'Unnamed Plan') }}</strong>
                    {% if plan.get('ai_strategy') %}
                    <br><small style="color: #666;">ğŸ¤– AI Generated</small>
                    {% endif %}
                </td>
                <td style="padding: 0.75rem;">
                    {{ plan.get('start_date', '') }} to {{ plan.get('end_date', '') }}
                </td>
                <td style="padding: 0.75rem;">
                    {% if plan.get('created_at') %}
                    <small class="text-muted">{{ plan.created_at }}</small>
                    {% else %}
                    <small class="text-muted">-</small>
                    {% endif %}
                </td>
                <td style="padding: 0.75rem;">
                    <div class="flex gap-1">
                        <button onclick="loadMealPlan('{{ plan.id }}')" class="btn btn-primary" style="padding: 0.5rem 1rem;">
                            ğŸ“¥ Load
                        </button>
                        <button onclick="deleteMealPlan('{{ plan.id }}')" class="btn" style="padding: 0.5rem 1rem; background: #dc3545; color: white;">
                            ğŸ—‘ï¸ Delete
                        </button>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="card">
    <p style="text-align: center; color: #666; padding: 2rem;">
        No saved meal plans yet. Create a meal plan and click "ğŸ’¾ Save Plan" to save it.
    </p>
</div>
{% endif %}

{% endblock %}

{% block extra_js %}
<script>
async function loadMealPlan(planId) {
    if (!confirm('Load this meal plan? This will replace your current meal plan.')) {
        return;
    }
    
    try {
        const response = await fetch(`/meal-plan/load/${planId}`, {
            method: 'POST'
        });
        
        const data = await response.json();
        
        if (data.success) {
            alert('âœ… Meal plan loaded!');
            window.location.href = '{{ url_for("meal_plan") }}';
        } else {
            alert('âŒ Error: ' + (data.error || 'Failed to load meal plan'));
        }
    } catch (error) {
        console.error('Error loading meal plan:', error);
        alert('âŒ Failed to load meal plan');
    }
}

async function deleteMealPlan(planId) {
    if (!confirm('Are you sure you want to delete this meal plan? This cannot be undone.')) {
        return;
    }
    
    try {
        const response = await fetch(`/meal-plan/delete/${planId}`, {
            method: 'POST'
        });
        
        const data = await response.json();
        
        if (data.success) {
            alert('âœ… Meal plan deleted!');
            location.reload();
        } else {
            alert('âŒ Error: ' + (data.error || 'Failed to delete meal plan'));
        }
    } catch (error) {
        console.error('Error deleting meal plan:', error);
        alert('âŒ Failed to delete meal plan');
    }
}
</script>
{% endblock %}
